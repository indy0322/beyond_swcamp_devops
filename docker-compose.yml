services:
  mariadb-persist:                                    
    image: mariadb:latest
    container_name: mariadb-persist
    environment:
      - MARIADB_ROOT_PASSWORD=root1234
      - MARIADB_DATABASE=calcdb
    ports:
      - "3310:3306"
    volumes:
      - mariadb-volume:/var/lib/mysql
      - mariadb-logs:/var/log/mysql
    networks:
      - camp-net
    restart: always
    command: >                                        
      --log-error=/var/log/mysql/error.log
      --general-log=1
      --general-log-file=/var/log/mysql/general.log
      --slow-query-log=1
      --slow-query-log-file=/var/log/mysql/slow.log
      --long-query-time=2
    healthcheck:                                      
      test: ["CMD", "healthcheck.sh", "--connect", "--innodb_initialized"]
      interval: 10s
      timeout: 5s
      retries: 5

  springboot-app:
    build:
      context: ./ch02_01_bootproject
    image: indy0322/calc-volume:latest                  
    container_name: spring-calc-with-db               
    ports:
      - "8055:7777"                                   
    networks:
      - camp-net
    depends_on:                                       
      mariadb-persist:
        condition: service_healthy
    restart: always

  vue-app:
    build:
      context: ./ch02_02_vueproject
    image: indy0322/vue_19_project
    container_name: vue-container-integrated          
    ports:
      - "8011:5173"
    networks:
      - camp-net
    depends_on:                                      
      - springboot-app
    restart: always

volumes:                                              
  mariadb-volume:
    driver: local
  mariadb-logs:
    driver: local

networks:
  camp-net:
    driver: bridge